<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘è‰²è¿½ç·ä»¤ï¼šè³­å ´é¢¨é›²</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ä½¿ç”¨ Inter å’Œ Noto Sans TC ç¢ºä¿ä¸­è‹±æ–‡å­—é«”ç¾è§€ */
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background-color: #1a1a2e; /* æ·±è‰²èƒŒæ™¯, ç¬¦åˆé»‘å¹«ä¸»é¡Œ */
        }
        .text-shadow-custom {
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5), 0 0 10px rgba(255, 215, 0, 0.3);
        }
        .gold-button {
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -2px rgba(0, 0, 0, 0.4);
            font-weight: 700;
        }
        .gold-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
        }
        .gold-button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }
        .gold-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(0.5);
        }
        /* æˆåŠŸç•«é¢ç‰¹æ•ˆ */
        .success-bg {
            background: radial-gradient(circle at center, #ffeb3b 0%, #ffc107 70%, #ff9800 100%);
            animation: pulse-gold 1.5s infinite alternate;
        }
        @keyframes pulse-gold {
            from { filter: brightness(1.0); }
            to { filter: brightness(1.1); }
        }
        /* æ™‚é–“å¿«åˆ°æ™‚çš„é–ƒçˆæ•ˆæœ */
        .timer-warning {
            animation: flash-red 0.5s infinite alternate;
        }
        @keyframes flash-red {
            from { background-color: #8b0000; }
            to { background-color: #dc2626; }
        }
        /* å€’æ•¸å‰©ä¸‹ 2 åˆ†é˜æ™‚çš„æ”¾å¤§æ•ˆæœ */
        .timer-large {
            font-size: 1.5rem; /* è®Šå¤§ */
            padding: 0.75rem; /* å¢åŠ å…§é‚Šè· */
            border: 3px solid #ffeb3b; /* å¢åŠ é‚Šæ¡†å¼·èª¿ */
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
            transition: all 0.3s ease-in-out;
        }
        /* æ•˜äº‹æ·¡å…¥æ·¡å‡ºæ•ˆæœ */
        .fade-transition {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .fade-in {
            opacity: 1;
        }
        .fade-out {
            opacity: 0;
        }
        /* è€å¤§é¸æ“‡ä»‹é¢æ¨£å¼ */
        .boss-item {
            aspect-ratio: 1 / 1;
        }
        .boss-check {
            opacity: 0;
            transition: opacity 0.2s;
        }
        /* æ’è¡Œæ¦œè¡¨æ ¼æ¨£å¼ */
        .leaderboard-table {
            border-collapse: separate;
            border-spacing: 0 5px; /* å¢åŠ è¡Œé–“è· */
        }
        .leaderboard-table td {
            padding: 8px;
        }
        /* æ’è¡Œæ¦œæ²è»¸æ¨£å¼ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #eab308;
            border-radius: 10px;
        }
    </style>
    
    <!-- å¼•å…¥ Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, where, orderBy, getDocs, Timestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCR-oc58h8fmdqt-7VU1F9hstznu0l0vvQ",
            authDomain: "casini-game.firebaseapp.com",
            projectId: "casini-game",
            storageBucket: "casini-game.firebasestorage.app",
            messagingSenderId: "615777698848",
            appId: "1:615777698848:web:a6ec9b8eb872168d86a845"
        };
        
        window.firebaseApp = initializeApp(firebaseConfig);
        window.db = getFirestore(window.firebaseApp);
        window.auth = getAuth(window.firebaseApp);
        window.APP_ID = firebaseConfig.projectId;
        window.currentUserId = null;
        window.isAuthReady = false;

        setLogLevel('error');
        
        onAuthStateChanged(window.auth, (user) => {
            if (user) {
                window.currentUserId = user.uid;
                console.log("Firebase: åŒ¿åç™»å…¥æˆåŠŸ. User ID:", user.uid);
            } else {
                window.currentUserId = null;
                console.log("Firebase: èªè­‰å¤±æ•—æˆ–ç­‰å¾…ä¸­.");
            }
            window.isAuthReady = true;
        });
        
        window.fs = { collection, addDoc, serverTimestamp, query, where, orderBy, getDocs, Timestamp, signInAnonymously };
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- èƒŒæ™¯éŸ³æ¨‚èˆ‡éŸ³æ•ˆ -->
    <audio id="bgm" loop>
        <source src="Mission Impossible Theme (Full Theme).mp3" type="audio/mp3">
    </audio>
    <audio id="success-sound">
        <source src="SUCCESS_Sound.mp4" type="audio/mp4">
    </audio>
    <audio id="late-sound">
        <source src="LATE_sound.mp4" type="audio/mp4">
    </audio>

    <div id="game-container" class="bg-gray-800 text-white p-6 md:p-10 rounded-xl shadow-2xl max-w-lg w-full transition-all duration-500">
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-6 text-yellow-400 text-shadow-custom">
            é»‘è‰²è¿½ç·ä»¤ï¼šè³­å ´é¢¨é›²
        </h1>

        <div id="timer-display" class="text-center text-xl font-mono p-2 mb-4 rounded-lg bg-red-800 text-yellow-300 shadow-inner hidden"></div>

        <div id="game-content" class="text-lg space-y-4"></div>

        <div id="game-controls" class="mt-8 flex flex-col space-y-4"></div>

        <div id="message-area" class="mt-4 p-3 rounded-lg text-center font-bold hidden"></div>
    </div>

    <script type="text/javascript">
        let db = null;
        let auth = null;
        let APP_ID = null;
        let fs = null;
        
        const GAME_STATE = {
            START: 0,
            VAULT_LOCATE: 1,
            CLUE_HUNT: 2,
            CODE_ENTRY: 3,
            SUCCESS: 4,
            FAIL: 5
        };

        const CORRECT_CLUE = "é‡‘åº«å®ˆå‰‡";
        const CORRECT_CODE = "275"; 
        const INITIAL_TIME_SECONDS = 600;

        let timerInterval = null;
        let timeLeft = INITIAL_TIME_SECONDS;
        let currentState = GAME_STATE.START;
        let playerName = "";
        let selectedBossId = null; 
        let missionStartTime = 0;
        let completionTime = 0;
        let hintsRevealed = 0; 
        let currentDialogueStep = 0; 
        
        let container, contentDiv, controlsDiv, messageArea, timerDisplay, bgm, successSound, lateSound;

        const DIALOGUE_STEPS = (name) => [
            { speaker: 'BOSS', text: `<span class="text-red-400">${name}</span>ä½ ä¾†å•¦â‹¯â‹¯`, buttonText: "ç¹¼çºŒ" },
            { speaker: 'PLAYER', text: `è€å¤§ï¼æœ‰ä½•å©å’ï¼Ÿ`, buttonText: "ç¹¼çºŒ" },
            { speaker: 'BOSS', text: `ä½ è¢«é‚€è«‹åˆ°é€™å ´ç”±é»‘å¹«èˆ‰è¾¦çš„è³­å ´å®´æœƒï¼Œè¡¨é¢ä¸Šæ˜¯ä¾†ä¸€æ“²åƒé‡‘çš„å®¢äººï¼Œä½†ä½ çœŸæ­£çš„ç›®æ¨™æ˜¯è³­å ´å¾Œé¢çš„é‚£åº§<span class="text-yellow-500 font-bold">é‡‘åº«</span>ï¼`, buttonText: "ç¹¼çºŒ" },
            { 
                speaker: 'BOSS', 
                text: `ä»Šå¤©å¾ˆå¤šå…¶ä»–é»‘å¹«æˆå“¡ä¹Ÿæ˜¯æ‰“è‘—è·Ÿä½ ä¸€æ¨£çš„ä¸»æ„ï¼Œä½ å¿…é ˆçˆ­åˆ†å¥ªç§’ï¼Œç›¡å¿«æŠŠé‡‘åº«æ‰“é–‹ï¼Œ<span class="text-yellow-400 font-bold">ä¸ç„¶è£¡é¢çš„é‡‘å¹£æœƒè¢«å…¶ä»–äººæ·è¶³å…ˆç™»ï¼</span>`, 
                buttonText: "ç¹¼çºŒ" 
            },
            {
                speaker: 'BOSS',
                text: `ç¾åœ¨ï¼Œä½ è¶ä¿é¢åœ¨æ‰“çŒç¡ï¼Œå·²ç¶“å·å·æ½›å…¥åˆ°äº†è³­å ´çš„é‡‘åº«ä½ç½®ã€‚<br>å™“ï¼å°å¿ƒä¸è¦è¢«ç™¼ç¾ï¼<br><span class="text-yellow-400 font-bold">ååˆ†é˜å…§</span>ä½ å¿…é ˆè§£å‡ºé€™å€‹è¬é¡Œï¼Œä¸ç„¶æ›ç­çš„äººå°±è¦ä¾†äº†ï¼Œä½ æœƒè¢«æŠ“å€‹æ­£è‘—ï¼<br>ä»”ç´°æŸ¥çœ‹é‡‘åº«åœ¨å“ªè£¡ï¼Ÿé‚„æœ‰å¯†ç¢¼ï¼Œä½ éœ€è¦çŸ¥é“å¯†ç¢¼æ˜¯å¹¾ä½æ•¸ã€‚`,
                buttonText: "å·å·æ½›å…¥é‡‘åº«",
                action: 'START_MISSION'
            }
        ];

        function initGame() {
            container = document.getElementById('game-container');
            contentDiv = document.getElementById('game-content');
            controlsDiv = document.getElementById('game-controls');
            messageArea = document.getElementById('message-area');
            timerDisplay = document.getElementById('timer-display');
            bgm = document.getElementById('bgm');
            successSound = document.getElementById('success-sound');
            lateSound = document.getElementById('late-sound');
            
            db = window.db;
            auth = window.auth;
            APP_ID = window.APP_ID;
            fs = window.fs;

            if (!db || !auth || !APP_ID || !fs) {
                setTimeout(initGame, 1000);
                return;
            }
            goToInitialImageScreen();
        }
        
        function startBGM() {
            if (bgm && bgm.paused) {
                bgm.volume = 0.5;
                bgm.play().catch(error => console.log("BGM æ’­æ”¾å¤±æ•—ã€‚"));
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function updateTimer() {
            if (timeLeft < 0) timeLeft = 0;
            timerDisplay.textContent = `å‰©é¤˜æ™‚é–“: ${formatTime(timeLeft)}`;
            if (timeLeft <= 120 && timeLeft > 0) timerDisplay.classList.add('timer-large');
            else timerDisplay.classList.remove('timer-large');
            if (timeLeft <= 60 && timeLeft > 0) timerDisplay.classList.add('timer-warning');
            else timerDisplay.classList.remove('timer-warning');
            if (timeLeft <= 0) {
                stopTimer();
                timerDisplay.textContent = "æ™‚é–“åˆ°ï¼æ›ç­ä¿é¢å·²åˆ°ï¼Œè«‹å¿«é€Ÿå®Œæˆå¯†ç¢¼è¼¸å…¥ã€‚";
                return;
            }
            timeLeft--;
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timeLeft = INITIAL_TIME_SECONDS;
            timerDisplay.classList.remove('hidden');
            updateTimer(); 
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() { 
            if (timerInterval) { 
                clearInterval(timerInterval); 
                timerInterval = null; 
            } 
        }

        function showMessage(text, isError = false) {
            messageArea.textContent = text;
            messageArea.className = `mt-4 p-3 rounded-lg text-center font-bold ${isError ? 'bg-red-700' : 'bg-green-700'}`;
            messageArea.classList.remove('hidden');
            setTimeout(() => { messageArea.classList.add('hidden'); }, 3500);
        }

        function clearScreen() {
            contentDiv.innerHTML = '';
            controlsDiv.innerHTML = '';
        }

        function renderButton(text, onClick, id = null) {
            const button = document.createElement('button');
            button.textContent = text;
            button.className = 'gold-button bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-lg w-full';
            button.onclick = (e) => onClick(e);
            if (id) button.id = id;
            controlsDiv.appendChild(button);
            return button;
        }

        function renderInput(placeholder, buttonText, onSubmit, inputId, maxLength) {
            const constContainer = document.createElement('div');
            constContainer.className = 'flex flex-col space-y-3';
            const input = document.createElement('input');
            input.id = inputId;
            input.type = 'text';
            input.maxLength = maxLength || 50;
            input.placeholder = placeholder;
            input.className = 'p-3 rounded-lg bg-gray-700 text-white border-2 border-yellow-500 focus:outline-none focus:border-yellow-400';
            const button = document.createElement('button');
            button.textContent = buttonText;
            button.className = 'gold-button bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-lg';
            button.onclick = (e) => onSubmit(document.getElementById(inputId).value, e.target);
            input.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') onSubmit(document.getElementById(inputId).value, button);
            });
            constContainer.appendChild(input);
            constContainer.appendChild(button);
            controlsDiv.appendChild(constContainer);
        }

        function revealHint() {
            const HINTS = [
                "æç¤º 1: ä½ æœ‰ç™¼ç¾é‡‘åº«ä¸Šé¢çš„æç¤ºã€Œè€å¤§æ‰èƒ½ç¢°ã€ï¼Œè€å¤§åœ¨è³­å ´è£¡çš„èŠ±è‰²é€šå¸¸æ˜¯ä»£è¡¨ã€é»‘æ¡ƒã€ï¼Œä½†æ˜¯é‡‘åº«å®ˆå‰‡ä¸Šä¼¼ä¹ä¸åªæœ‰ä¸€ç¨®é¡è‰²çš„ã€é»‘æ¡ƒã€â‹¯â‹¯",
                "æç¤º 2: é‡‘åº«å®ˆå‰‡ä¸Šä¼¼ä¹æœ‰å¾ˆå¤šä¸åŒé¡è‰²çš„ç­†ç•«ï¼Œä»”ç´°çœ‹çœ‹å¥½åƒæ˜¯æ•¸å­—â‹¯â‹¯ä¹Ÿè¨±é€™è·Ÿå¯†ç¢¼æœ‰ä»€éº¼é—œä¿‚ï¼Ÿ",
                "é‡‘åº«å¯†ç¢¼æ˜¯ä¸‰ä½æ•¸ï¼Œç´…è‰²çš„é»‘æ¡ƒä¹Ÿæ˜¯ä¸‰å€‹â‹¯â‹¯å‰©ä¸‹å°±æ˜¯æ¯å€‹é»‘æ¡ƒåˆ†åˆ¥ä»£è¡¨å“ªå€‹æ•¸å­—äº†â‹¯â‹¯"
            ];

            if (hintsRevealed >= HINTS.length) {
                showMessage("å·²ç¶“æ²’æœ‰æ›´å¤šæç¤ºäº†ï¼", true);
                return;
            }

            const timeDeduction = 60;
            if (timeLeft - timeDeduction <= 0) {
                timeLeft = 0; 
                showMessage("æ™‚é–“ç”¨ç›¡ï¼ä½ ç„¡æ³•å†ç²å–æç¤ºäº†ã€‚", true);
                updateTimer();
            } else {
                timeLeft -= timeDeduction;
                showMessage(`æ‰£é™¤ ${timeDeduction} ç§’ã€‚è«‹åƒè€ƒæ–°æç¤ºã€‚`, false);
                updateTimer();
            }

            const hintDiv = document.getElementById('hint-messages');
            const p = document.createElement('p');
            p.className = "mt-2 p-3 bg-gray-700 rounded-lg border border-red-500 transition-all duration-300 transform scale-100 hover:scale-[1.02] text-sm";
            p.innerHTML = `<span class="text-red-400 font-bold">[æç¤º #${hintsRevealed + 1} (-60ç§’)]</span>: ${HINTS[hintsRevealed]}`;
            hintDiv.appendChild(p);
            hintsRevealed++;

            const hintButton = document.getElementById('reveal-hint-button');
            if (hintsRevealed >= HINTS.length) {
                hintButton.textContent = "å·²ç„¡æ›´å¤šæç¤º";
                hintButton.disabled = true;
                hintButton.classList.add('bg-gray-500', 'cursor-not-allowed');
            }
        }

        function getPublicRanksCollectionRef() {
            if (!db || !APP_ID) return null;
            return fs.collection(db, `artifacts/${window.APP_ID}/public/data/puzzle_ranks`);
        }

        async function recordCompletionAndShowRank() {
            const uid = window.currentUserId;
            const defaultResult = { rank: 'N/A', successRank: 'N/A', totalRecords: 'N/A', topTenRanks: [] };
            if (!db || !uid) return defaultResult;

            const ranksRef = getPublicRanksCollectionRef();
            if (!ranksRef) return defaultResult;

            const newRecord = { 
                name: playerName, 
                userId: uid, 
                completionTime: completionTime, 
                timestamp: fs.serverTimestamp(), 
                bossId: selectedBossId 
            };
            
            let docRef;
            try { 
                docRef = await fs.addDoc(ranksRef, newRecord); 
            } catch (e) { 
                return defaultResult; 
            }

            try {
                const todayStart = new Date(); 
                todayStart.setHours(0, 0, 0, 0); 
                const querySnapshot = await fs.getDocs(fs.query(ranksRef));
                
                const allTodayDocs = querySnapshot.docs
                    .map(d => ({ id: d.id, ...d.data() }))
                    .filter(d => d.timestamp && d.timestamp.toDate() >= todayStart);

                const sortedByEntry = [...allTodayDocs].sort((a, b) => {
                    const timeA = a.timestamp ? (a.timestamp.seconds || 0) : 0;
                    const timeB = b.timestamp ? (b.timestamp.seconds || 0) : 0;
                    return timeA - timeB;
                });
                
                const rank = sortedByEntry.findIndex(d => d.id === docRef.id) + 1;
                const totalRecords = allTodayDocs.length;
                const qualifiers = sortedByEntry.filter(d => d.completionTime < INITIAL_TIME_SECONDS);
                const successRank = qualifiers.findIndex(d => d.id === docRef.id) + 1;

                // æ“´å……ç‚ºé¡¯ç¤ºå‰ 50 å
                const topTenRanks = [...allTodayDocs]
                    .sort((a, b) => a.completionTime - b.completionTime)
                    .slice(0, 50)
                    .map((data, index) => ({
                        rank: index + 1,
                        name: data.name || "ç¥ç§˜ç‰¹å·¥",
                        time: formatTime(data.completionTime || 0),
                        isPlayer: data.userId === uid
                    }));

                return { rank, successRank: successRank > 0 ? successRank : 'N/A', totalRecords, topTenRanks };
            } catch (e) {
                console.error("æ’åè¨ˆç®—å‡ºéŒ¯:", e);
                return defaultResult;
            }
        }

        function renderLeaderboard(ranks) {
            if (!ranks || ranks.length === 0) return `<p class="text-center p-4 text-gray-500">ç›®å‰æ²’æœ‰æ’åç´€éŒ„ã€‚</p>`;
            
            let tableRows = ranks.map(rank => `
                <tr class="${rank.isPlayer ? 'bg-yellow-400 text-gray-900 font-extrabold shadow-md' : 'bg-gray-700 text-gray-200'} transition hover:bg-yellow-200">
                    <td class="p-2 text-center rounded-l-lg">${rank.rank}</td>
                    <td class="p-2 font-semibold">${rank.name}</td>
                    <td class="p-2 text-right rounded-r-lg font-mono">${rank.time}</td>
                </tr>
            `).join('');

            return `
                <div class="mt-8 pt-4 border-t border-yellow-600">
                    <h3 class="text-2xl font-bold text-yellow-500 mb-4 text-center">ä»Šæ—¥æœ€é€Ÿé»‘å¹« (Top 50)</h3>
                    <div class="w-full max-w-sm mx-auto bg-gray-900 rounded-lg overflow-hidden">
                        <div class="max-h-96 overflow-y-auto custom-scrollbar p-1">
                            <table class="leaderboard-table w-full text-sm">
                                <thead>
                                    <tr class="text-gray-400 sticky top-0 bg-gray-900 z-10">
                                        <th class="p-2 w-1/6 text-center">æ’å</th>
                                        <th class="p-2 w-3/6 text-left">åŒ–å</th>
                                        <th class="p-2 w-2/6 text-right">è€—æ™‚</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <p class="text-center text-xs text-gray-500 mt-2">æ»‘å‹•ä¸Šæ–¹åˆ—è¡¨æŸ¥çœ‹æ›´å¤šæ’å</p>
                </div>
            `;
        }

        function displayNextDialogue() {
            const dialogueData = DIALOGUE_STEPS(playerName);
            if (currentDialogueStep >= dialogueData.length) { 
                goToVaultLocate(); 
                return; 
            }

            const step = dialogueData[currentDialogueStep];
            const currentContent = document.getElementById('dialogue-wrapper');
            if (currentContent) { 
                currentContent.classList.remove('fade-in'); 
                currentContent.classList.add('fade-out'); 
            }

            setTimeout(() => {
                controlsDiv.innerHTML = '';
                let wrapper = document.getElementById('dialogue-wrapper');
                if (!wrapper) { 
                    wrapper = document.createElement('div'); 
                    wrapper.id = 'dialogue-wrapper'; 
                    contentDiv.appendChild(wrapper); 
                }
                wrapper.className = 'fade-transition space-y-4 fade-in'; 
                const speakerName = step.speaker === 'PLAYER' ? playerName : 'è€å¤§';
                wrapper.innerHTML = `
                    <div class="p-4 bg-gray-700 rounded-lg shadow-inner">
                        <p class="${step.speaker === 'BOSS' ? 'text-yellow-400' : 'text-green-400'} font-bold mb-2">${speakerName}:</p>
                        <p class="text-gray-200">${step.text}</p>
                    </div>
                `;
                
                renderButton(step.buttonText, () => {
                    if (step.action === 'START_MISSION') { 
                        missionStartTime = Date.now(); 
                        startTimer(); 
                        goToVaultLocate(); 
                    } else { 
                        currentDialogueStep++; 
                        displayNextDialogue(); 
                    }
                });
                window.scrollTo(0, 0); 
            }, 1000); 
        }

        function goToInitialImageScreen() {
            clearScreen(); 
            stopTimer(); 
            timerDisplay.classList.add('hidden');
            
            document.body.className = 'min-h-screen flex items-center justify-center p-4 bg-gray-900';
            contentDiv.innerHTML = `
                <div class="text-center space-y-6">
                    <p class="text-lg text-gray-300">ä¸€å ´ç§˜å¯†è¡Œå‹•å³å°‡å±•é–‹...</p>
                    <img src="cover.jpg" onerror="this.onerror=null; this.src='https://placehold.co/400x200/29294F/FFF?text=èµ·å§‹ç•«é¢åœ–ç‰‡';" class="mx-auto w-full max-w-sm rounded-lg shadow-xl border-2 border-yellow-500 object-cover">
                </div>
            `;
            
            const checkboxArea = document.createElement('div');
            checkboxArea.className = 'mt-6 space-y-3 text-left text-gray-200';
            checkboxArea.innerHTML = `
                <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="checkbox" id="check-network" class="form-checkbox h-5 w-5 text-yellow-500 bg-gray-700 border-gray-500 rounded focus:ring-0">
                    <span>è«‹ç¢ºä¿ç¶²è·¯ç©©å®š</span>
                </label>
                <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="checkbox" id="check-volume" class="form-checkbox h-5 w-5 text-yellow-500 bg-gray-700 border-gray-500 rounded focus:ring-0">
                    <span>è«‹æ‰“é–‹éŠæˆ²éŸ³é‡</span>
                </label>
            `;
            controlsDiv.appendChild(checkboxArea);

            const initialButton = renderButton("é€²å…¥ç§˜å¯†ä»»å‹™", () => {
                if (!initialButton.disabled) { 
                    if (window.auth && !window.auth.currentUser) fs.signInAnonymously(auth); 
                    goToBossSelection(); 
                } else {
                    showMessage("è«‹ç¢ºä¿ä¸Šæ–¹å…©é …çš†å·²ç¢ºèª", true);
                }
            }, 'initial-start-button');

            initialButton.disabled = true; 
            initialButton.className = 'gold-button bg-gray-500 cursor-not-allowed text-white px-6 py-3 rounded-lg w-full mt-6';
            
            const checkPre = () => {
                const isReady = document.getElementById('check-network').checked && document.getElementById('check-volume').checked;
                initialButton.disabled = !isReady;
                initialButton.className = isReady ? 'gold-button bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-lg w-full mt-6' : 'gold-button bg-gray-500 cursor-not-allowed text-white px-6 py-3 rounded-lg w-full mt-6';
            };
            document.getElementById('check-network').addEventListener('change', checkPre);
            document.getElementById('check-volume').addEventListener('change', checkPre);
        }

        function goToBossSelection() {
            clearScreen(); 
            window.scrollTo(0, 0); 
            selectedBossId = null;
            
            contentDiv.innerHTML = `
                <h2 class="text-2xl font-bold text-yellow-400 text-center mb-4">ä½ çš„è€å¤§æ˜¯ï¼Ÿ</h2>
                <p class="text-sm text-gray-400 text-center mb-6">*äººç‰©ä¸å½±éŸ¿æ•…äº‹é€²è¡Œ</p>
                <div id="boss-grid" class="grid grid-cols-3 gap-2"></div>
            `;
            
            const confirmButton = renderButton("æˆ‘çš„è€å¤§æ˜¯ä»–/å¥¹", () => {
                if (window.isAuthReady && window.currentUserId) {
                    goToNameInput();
                } else {
                    showMessage("ä¼ºæœå™¨é€£ç·šä¸­ï¼Œè«‹ç¨å€™å†è©¦ã€‚", true);
                }
            }, 'confirm-boss-button');

            confirmButton.disabled = true; 
            confirmButton.className = 'gold-button bg-gray-500 cursor-not-allowed text-white px-6 py-3 rounded-lg w-full mt-6';
            
            const gridDiv = document.getElementById('boss-grid');
            [1, 2, 3, 4, 5, 6, 7, 8, 9].forEach(id => {
                const item = document.createElement('div');
                item.className = 'boss-item relative cursor-pointer border-4 border-transparent rounded-lg overflow-hidden transition-all duration-200 hover:border-yellow-500';
                item.innerHTML = `
                    <img src="boss_${id}.png" onerror="this.onerror=null; this.src='https://placehold.co/100x100/3A3A3A/FFF?text=Boss%20${id}';" class="w-full h-full object-cover rounded-md">
                    <div id="check-${id}" class="boss-check absolute inset-0 bg-black/50 flex items-center justify-center text-4xl text-yellow-400">âœ“</div>
                `;
                item.onclick = () => {
                    selectedBossId = id;
                    document.querySelectorAll('.boss-item').forEach(i => i.classList.remove('border-yellow-400'));
                    document.querySelectorAll('.boss-check').forEach(c => c.classList.remove('opacity-100'));
                    item.classList.add('border-yellow-400'); 
                    item.querySelector('.boss-check').classList.add('opacity-100');
                    if (window.isAuthReady) { 
                        confirmButton.disabled = false; 
                        confirmButton.className = 'gold-button bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-lg w-full mt-6'; 
                    }
                };
                gridDiv.appendChild(item);
            });
        }

        function goToNameInput() {
            clearScreen(); 
            contentDiv.innerHTML = `
                <h2 class="text-2xl font-bold text-yellow-400 text-center mb-6">å‘Šè¨´è€å¤§ä½ çš„ä»£è™Ÿ</h2>
                <p class="text-md text-gray-400 text-center">é€™æ˜¯ä½ ç¨ä¸€ç„¡äºŒçš„èº«ä»½ï¼Œå°‡ç”¨æ–¼ç´€éŒ„ä½ çš„é€šé—œé †åºã€‚</p>
            `;
            
            renderInput("è«‹è¼¸å…¥ä½ çš„é»‘å¹«åŒ–åï¼ˆ2-10å€‹å­—ï¼‰", "ç¢ºèªä»£è™Ÿ", async (name, button) => {
                const trimmedName = name.trim();
                if (trimmedName.length < 2 || trimmedName.length > 10) return showMessage("ä»£è™Ÿé•·åº¦éœ€åœ¨ 2 åˆ° 10 å€‹å­—å…ƒä¹‹é–“ã€‚", true);
                
                button.disabled = true; 
                button.textContent = "æ­£åœ¨é©—è­‰ä»£è™Ÿ...";
                
                try {
                    const todayStart = new Date(); 
                    todayStart.setHours(0, 0, 0, 0);
                    const snap = await fs.getDocs(getPublicRanksCollectionRef());
                    const isDuplicate = snap.docs.some(doc => doc.data().name === trimmedName && doc.data().timestamp?.toDate() >= todayStart);
                    
                    if (isDuplicate) {
                        showMessage("ä½ çš„ä»£è™Ÿå·²è¢«ä½¿ç”¨ï¼Œè«‹æ›´æ›ä¸€å€‹ã€‚", true); 
                        button.disabled = false; 
                        button.textContent = "ç¢ºèªä»£è™Ÿ";
                    } else { 
                        playerName = trimmedName; 
                        showMessage(`ä»£è™Ÿï¼š${playerName}ï¼Œç¢ºèªï¼`); 
                        setTimeout(goToMissionDialogue, 1500); 
                    }
                } catch (e) { 
                    showMessage("é€£ç·šé©—è­‰å¤±æ•—ï¼Œè«‹é‡è©¦ã€‚", true); 
                    button.disabled = false; 
                }
            }, 'codename-input', 10);
            
            document.getElementById('codename-input').focus();
        }

        function goToMissionDialogue() {
            currentState = GAME_STATE.START; 
            clearScreen(); 
            stopTimer(); 
            hintsRevealed = 0; 
            timerDisplay.classList.add('hidden'); 
            startBGM(); 
            
            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <img src="boss_${selectedBossId}.png" onerror="this.onerror=null; this.src='https://placehold.co/120x120/3A3A3A/FFF?text=BOSS';" class="mx-auto w-32 h-32 object-cover rounded-full shadow-lg border-4 border-red-500">
                </div>
                <div id="dialogue-content-area" class="space-y-4"></div>
            `;
            
            currentDialogueStep = 0; 
            displayNextDialogue();
        }

        function goToVaultLocate() {
            currentState = GAME_STATE.VAULT_LOCATE; 
            clearScreen(); 
            window.scrollTo(0, 0);
            
            contentDiv.innerHTML = `
                <p>ä½ ç¾åœ¨å·²ç¶“æˆåŠŸæ½›å…¥è³­å ´æ”¾<span class="text-yellow-500 font-bold">é‡‘åº«</span>çš„åœ°æ–¹ï¼è¶•å¿«æ‰¾æ‰¾é‡‘åº«åœ¨å“ªè£¡ï¼Ÿ</p>
                <hr class="my-4 border-gray-600">
                <p class="text-yellow-400"><strong>ã€è¡Œå‹•æŒ‡ç¤ºï¼šç¬¬ä¸€æ­¥ã€‘</strong></p>
                <p>ä»”ç´°è§€å¯Ÿç¾å¯¦ä¸–ç•Œä¸­çš„é‡‘åº«å¯¶ç®±ï¼Œ<strong>å¯†ç¢¼é–æ˜¯å¹¾ä½æ•¸ï¼Ÿ</strong></p>
            `;
            
            renderInput("è«‹è¼¸å…¥å¯†ç¢¼é–çš„ä½æ•¸ (æ•¸å­—)", "ç¢ºèªä½æ•¸", checkVaultDigits, 'digit-input', 1);
            document.getElementById('digit-input').type = 'number';
        }

        function checkVaultDigits(input) {
            const digitInput = parseInt(input.trim());
            if (digitInput === 3) {
                showMessage("æ•¸å­—æ­£ç¢ºï¼ä½ ç™¼ç¾äº†é‡‘åº«å¯†ç¢¼æ˜¯ä¸‰ä½æ•¸å¯†ç¢¼é–ã€‚", false);
                setTimeout(() => { 
                    window.scrollTo(0, 0); 
                    goToClueHunt(); 
                }, 2500);
                return;
            }

            let hintMessage = "é€™å€‹æ•¸å­—ä¸æ­£ç¢ºï¼Œå†å˜—è©¦çœ‹çœ‹";
            if (isNaN(digitInput) || digitInput === 0) {
                hintMessage = "è«‹è¼¸å…¥ä¸€å€‹æ•¸å­—ã€‚ä½ éœ€è¦æ‰¾åˆ°é‡‘åº«å¯¶ç®±ï¼Œä¸Šé¢æ‡‰è©²æœ‰å¯†ç¢¼é–ã€‚";
            } else if (digitInput > 4) {
                hintMessage = `é€™å€‹æ•¸å­—å¤ªå¤§äº†ã€‚å†ä»”ç´°çœ‹çœ‹ï¼Œé€™å€‹é–çš„çµæ§‹ä¼¼ä¹å¾ˆç°¡å–®ï¼Œåªé å¹¾å€‹è½‰ç›¤é‹ä½œã€‚`;
            } else if (digitInput === 2) {
                hintMessage = `åªæœ‰å…©ä½æ•¸å—ï¼Ÿè«‹å†é è¿‘ä¸€é»æ•¸æ•¸çœ‹ï¼Œæ˜¯ä¸æ˜¯æœ‰â‹¯â‹¯ï¼Ÿ`;
            } else if (digitInput === 4) {
                hintMessage = `ä¸å°ï¼Œå®ƒä¸æ˜¯å››ä½æ•¸çš„ã€‚ä»”ç´°æ•¸æ•¸ï¼Œå¯†ç¢¼é–ä¸Šæœ‰å¹¾å€‹å¯ä»¥è½‰å‹•çš„ã€‚`;
            }
            showMessage(hintMessage, true);
        }

        function goToClueHunt() {
            currentState = GAME_STATE.CLUE_HUNT; 
            clearScreen(); 
            window.scrollTo(0, 0);
            
            contentDiv.innerHTML = `
                <p>ä½ ç¢ºèªäº†ï¼Œé‡‘åº«é–éœ€è¦<strong>ä¸‰ä½æ•¸å¯†ç¢¼</strong>æ‰èƒ½æ‰“é–‹ã€‚åŒæ™‚ï¼Œä½ ç™¼ç¾<strong>é‡‘åº«ä¸Šæœ‰ä¸€å€‹æç¤º</strong>å¯«è‘—ä»€éº¼â‹¯â‹¯ã€‚</p>
                <p>é‡‘åº«å¯†ç¢¼æ¯å¤©éƒ½æœƒæ›ï¼Œä½†ä½ äº‹å‰å·²ç¶“èª¿æŸ¥éï¼Œè³­å ´ä¸»äººè¨˜æ€§å­¸å·®ï¼Œ<strong>ç›¸é—œçš„æç¤ºä¸€å®šå°±åœ¨é‡‘åº«é™„è¿‘</strong>ã€‚</p>
                <hr class="my-4 border-gray-600">
                <p class="text-yellow-400"><strong>ã€è¡Œå‹•æŒ‡ç¤ºï¼šç¬¬äºŒæ­¥ã€‘</strong></p>
                <p>ç’°é¡§å››å‘¨ï¼Œå°‹æ‰¾å‘¨é‚Šç‰©å“ï¼Œä»€éº¼æ±è¥¿çœ‹èµ·ä¾†åƒæ˜¯åœ¨æä¾›å¯†ç¢¼çš„ç·šç´¢ï¼Ÿ</p>
            `;
            
            renderInput("è«‹è¼¸å…¥ä½ ç™¼ç¾çš„ç·šç´¢åç¨±å…¨å ", "ç¢ºèªç·šç´¢", checkClue, 'clue-input');
        }

        function checkClue(input) {
            if (input.trim().replace(/\s/g, '').toLowerCase() === CORRECT_CLUE.toLowerCase()) {
                showMessage("ç·šç´¢ç¢ºèªï¼é€™å°±æ˜¯æˆ‘å€‘è¦æ‰¾çš„ï¼"); 
                setTimeout(() => goToCodeEntry(), 1500);
            } else {
                let hintMessage = "å†æ‰¾æ‰¾çœ‹ï¼Œæ‡‰è©²ä¸æœƒæ”¾åœ¨å¤ªé çš„åœ°æ–¹";
                if (input.includes("è¦å‰‡") || input.includes("å®ˆå‰‡")) hintMessage = "å¾ˆæ¥è¿‘äº†ï¼è©¦è©¦çœ‹å®Œæ•´çš„åç¨±ï¼";
                showMessage(hintMessage, true);
            }
        }

        function goToCodeEntry() {
            currentState = GAME_STATE.CODE_ENTRY; 
            clearScreen(); 
            window.scrollTo(0, 0);
            
            contentDiv.innerHTML = `
                <p>å¾ˆå¥½ï¼Œä½ å·²ç¶“æŒæ¡äº†é—œéµç·šç´¢ï¼š<strong>ã€é‡‘åº«å®ˆå‰‡ã€‘</strong>ã€‚</p>
                <p>çµåˆä½ å‰›æ‰åœ¨é‡‘åº«é–ä¸Šç™¼ç¾çš„æç¤ºï¼Œç¾åœ¨æ˜¯æ™‚å€™ç ´è§£ä¸‰ä½æ•¸å¯†ç¢¼äº†ï¼</p>
                <hr class="my-4 border-gray-600">
                <p class="text-yellow-400"><strong>ã€è¡Œå‹•æŒ‡ç¤ºï¼šç¬¬ä¸‰æ­¥ã€‘</strong></p>
                <p>æ ¹æ“šå®ˆå‰‡å…§å®¹å’Œæç¤ºï¼Œæ¨ç®—å‡ºä¸‰ä½å¯†ç¢¼ã€‚é‡‘åº«è£¡çš„é‡‘å¹£ç­‰ä½ ï¼</p>
            `;
            
            const hintSection = document.createElement('div'); 
            hintSection.className = 'mt-6 p-4 bg-gray-700 rounded-lg shadow-inner';
            hintSection.innerHTML = `
                <h3 class="text-xl font-bold text-red-400 mb-2 flex items-center">
                    <span class="text-3xl mr-2">ğŸ’¡</span><span>3å€‹æç¤º</span>
                </h3>
                <p class="text-sm text-red-300 mb-3">æ™‚é–“æ­¸é›¶ä»å¯æ‰“é–‹é‡‘åº«ï¼Œä½†æ˜¯å¯èƒ½æœƒç™¼ç”Ÿâ‹¯â‹¯</p>
                <div id="hint-messages" class="space-y-2"></div>
            `;
            
            const hintButton = document.createElement('button'); 
            hintButton.id = 'reveal-hint-button'; 
            hintButton.textContent = "æ¯å€‹æç¤ºæ‰£é™¤ 60ç§’"; 
            hintButton.className = 'gold-button bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg w-full mt-4';
            hintButton.onclick = revealHint; 
            
            hintSection.appendChild(hintButton); 
            controlsDiv.appendChild(hintSection);
            
            renderInput("æ¯è¼¸éŒ¯ä¸€æ¬¡æ‰£é™¤30ç§’", "è§£é–é‡‘åº«ï¼", (v, btn) => {
                if (v === CORRECT_CODE) {
                    btn.disabled = true; 
                    btn.textContent = "æ­£åœ¨é€šå ±è€å¤§...";
                    const penaltyTaken = INITIAL_TIME_SECONDS - Math.max(0, timeLeft);
                    const actualTaken = Math.floor((Date.now() - missionStartTime) / 1000);
                    completionTime = Math.max(penaltyTaken, actualTaken); 
                    showMessage("å¯†ç¢¼æ­£ç¢ºï¼æ­£åœ¨è§£é–..."); 
                    setTimeout(() => handleFinalRanking(), 2000);
                } else {
                    timeLeft = Math.max(0, timeLeft - 30); 
                    updateTimer();
                    showMessage(timeLeft <= 0 ? "å¯†ç¢¼éŒ¯èª¤ï¼é–å®šæ©Ÿåˆ¶æ­£åœ¨å•Ÿå‹•... æ™‚é–“å·²ç”¨ç›¡ï¼" : "å¯†ç¢¼éŒ¯èª¤ï¼å°å¿ƒè­¦å ±å°±è¦éŸ¿äº†ï¼", true);
                }
            }, 'code-input', 3);
        }

        async function handleFinalRanking() {
            currentState = GAME_STATE.SUCCESS; 
            bgm.pause(); 
            stopTimer(); 
            timerDisplay.classList.add('hidden'); 
            clearScreen();
            
            contentDiv.innerHTML = `
                <div class="text-center py-10">
                    <h2 class="text-3xl font-bold text-yellow-400 mb-4">æ­£åœ¨å›å ±æˆ°æœä¸¦è¨ˆç®—æ’å...</h2>
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-500 mx-auto mt-6"></div>
                </div>
            `;
            
            try {
                const result = await recordCompletionAndShowRank();
                const isGrandSuccess = (completionTime < INITIAL_TIME_SECONDS) && (result.successRank > 0 && result.successRank <= 50);
                
                if (isGrandSuccess) {
                    successSound.play().catch(e => console.log(e));
                    goToSuccess(result.rank, result.successRank, result.topTenRanks);
                } else {
                    lateSound.play().catch(e => console.log(e));
                    goToLateSuccess(result.rank, result.successRank, result.topTenRanks);
                }
            } catch (e) {
                console.error("çµç®—é é¢æ¸²æŸ“å¤±æ•—:", e);
                goToLateSuccess('N/A', 'N/A', []);
            }
        }

        function goToSuccess(rank, successRank, topTenRanks) {
            document.body.className = 'min-h-screen flex items-center justify-center p-4 success-bg';
            container.className = 'bg-yellow-100 text-gray-900 p-6 md:p-10 rounded-xl shadow-2xl max-w-lg w-full border-4 border-yellow-700';
            clearScreen();
            
            contentDiv.innerHTML = `
                <div class="text-center">
                    <h2 class="text-4xl md:text-5xl font-extrabold text-yellow-700 mt-4 animate-bounce">ä½ æˆåŠŸæ‰“é–‹é‡‘åº«ï¼</h2>
                    <p class="text-xl font-bold mb-2">ä»£è™Ÿ: <span class="text-red-600">${playerName}</span></p>
                    <p class="text-2xl font-extrabold mb-4 text-red-700">è€—æ™‚: ${completionTime} ç§’</p>
                    
                    <div class="bg-yellow-200 p-3 rounded-lg shadow-md mb-6">
                        <p class="text-xl font-extrabold text-black mb-1">ğŸ‰é€šé—œæˆåŠŸé †ä½ï¼šç¬¬ ${successRank} å / 50 å</p>
                        <p class="text-sm text-green-700 font-bold">ä»Šæ—¥ç¬¬ ${rank} ä½æŒ‘æˆ°ç©å®¶!</p>
                    </div>

                    <p class="mt-6 text-xl">é‡‘å±±éŠ€å±±å°±åœ¨çœ¼å‰ï¼Œä½ å¾—æ‰‹äº†ï¼</p>
                    <img src="SUCCESS_IMAGE.png" onerror="this.onerror=null; this.src='https://placehold.co/200x150/FFD700/000?text=SUCCESS';" class="mx-auto w-3/4 max-w-sm object-contain my-6 shadow-lg">
                    
                    <p class="mt-4 text-2xl font-bold p-3 bg-yellow-300 rounded-lg"><strong>è«‹åˆ°ç°½åˆ°è™•é ˜å–çé …ï¼</strong></p>
                    ${renderLeaderboard(topTenRanks)}
                </div>
            `;
        }

        function goToLateSuccess(rank, successRank, topTenRanks) {
            document.body.className = 'min-h-screen flex items-center justify-center p-4 success-bg';
            container.className = 'bg-yellow-100 text-gray-900 p-6 md:p-10 rounded-xl shadow-2xl max-w-lg w-full border-4 border-yellow-700';
            clearScreen();
            
            contentDiv.innerHTML = `
                <div class="text-center">
                    <h2 class="text-4xl md:text-5xl font-extrabold text-yellow-700 mt-4 animate-bounce">ä½ æˆåŠŸæ‰“é–‹é‡‘åº«ï¼</h2>
                    <p class="text-xl font-bold mb-2">ä»£è™Ÿ: <span class="text-red-600">${playerName}</span></p>
                    <p class="text-2xl font-extrabold mb-4 text-red-700">è€—æ™‚: ${completionTime} ç§’</p>

                    <div class="bg-yellow-200 p-3 rounded-lg shadow-md mb-6">
                        <p class="text-xl font-extrabold text-black mb-1">
                            ${successRank > 0 && successRank <= 50 ? `ğŸ‰é€šé—œæˆåŠŸé †ä½ï¼šç¬¬ ${successRank} å / 50 å` : `â±ï¸æˆåŠŸé€šé—œï¼ä½†ä»»å‹™é€¾æ™‚`}
                        </p>
                        <p class="text-sm text-green-700 font-bold">ä»Šæ—¥ç¬¬ ${rank} ä½æŒ‘æˆ°ç©å®¶!</p>
                    </div>

                    <p class="mt-6 text-xl">ä½†æ˜¯æ²’æƒ³åˆ°ä½ ä¾†çš„å¤ªæ™šäº†ï¼Œåªå‰©ä¸‹â‹¯â‹¯</p>
                    <img src="LATE_IMAGE.png" onerror="this.onerror=null; this.src='https://placehold.co/200x150/FFD700/000?text=LATE';" class="mx-auto w-3/4 max-w-sm object-contain my-6 shadow-lg">
                    
                    <p class="mt-4 text-2xl font-bold p-3 bg-yellow-300 rounded-lg"><strong>è«‹åˆ°ç°½åˆ°è™•é ˜å–çé …ï¼</strong></p>
                    ${renderLeaderboard(topTenRanks)}
                </div>
            `;
        }

        function gameOver() {
            currentState = GAME_STATE.FAIL;
            clearScreen(); 
            stopTimer(); 
            window.scrollTo(0, 0);
            
            container.className = 'bg-red-900 text-white p-6 md:p-10 rounded-xl shadow-2xl max-w-lg w-full transition-all duration-500 border-4 border-red-700';
            contentDiv.innerHTML = `
                <div class="text-center">
                    <h2 class="text-4xl md:text-5xl font-extrabold text-red-400 mt-4">è¡Œå‹•å¤±æ•—ï¼</h2>
                    <p class="mt-6 text-xl">æ›ç­çš„ä¿é¢å·²ç¶“åˆ°é”ï¼Œä½ è¢«æŠ“å€‹æ­£è‘—ã€‚é‡‘å¹£å¤¢ç¢ï¼</p>
                    <p class="mt-4">ä¸‹æ¬¡æº–å‚™æ›´å……åˆ†å†ä¾†å§ã€‚</p>
                </div>
            `;
            renderButton("é‡æ–°é–‹å§‹", () => location.reload()); 
        }

        window.onload = initGame;
    </script>
</body>
</html>
